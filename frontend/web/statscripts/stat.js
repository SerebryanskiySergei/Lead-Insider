(function(){var f=new Date,g=location.origin+"/",k=h("LIref"),m=l("_LI_ref");function n(a,b,c,d){d=d||"POST";c=c||!0;b=b||null;return new Promise(function(u,v){var e=function(){var a;try{a=new ActiveXObject("Msxml2.XMLHTTP")}catch(b){try{a=new ActiveXObject("Microsoft.XMLHTTP")}catch(c){a=!1}}a||"undefined"===typeof XMLHttpRequest||(a=new XMLHttpRequest);return a}();e.open(d,a,c);"GET"===d&&c&&(e.responseType="json");e.onload=function(){199<e.status&&300>e.status?u(e.response):v(e.statusText)};e.send(b)})}
function p(){return n("http://ip-api.com/json/",null,!0,"GET").then(function(a){var b=a.countryCode.toLowerCase(),c=q.toLowerCase().split(",");a.match=!1;-1<c.indexOf(b)&&(a.match=!0);return Promise.resolve(a)})}function l(a){return(a=document.cookie.match(new RegExp("(?:^|; )"+a.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g,"\\$1")+"=([^;]*)")))?decodeURIComponent(a[1]):void 0}
function h(a){for(var b=location.search.substr(1).split("&"),c,d=0;d<b.length;d++)if(c=b[d].split("="),decodeURIComponent(c[0])===a)return decodeURIComponent(c[1])}var q=h("LIregion")||l("_LI_region"),r=document.referrer.substr(document.referrer.indexOf("//")+2);function t(a,b){document.cookie=a+"="+b+"; path=/; expires="+new Date(f.getTime()+2592E6)}
function w(){return p().then(function(a){return n("http://office.ldgn.ru/script/adduser",JSON.stringify({site:g,ref:k,from:r,targeting:a.match})).then(function(){return Promise.resolve(a)})})}function x(){p().then(function(a){n("http://office.ldgn.ru/script/addhit",JSON.stringify({site:g,ref:m,targeting:a.match}))})}function y(){m?x():k&&w().then(function(a){m=k;t("_LI_ip",a.query);t("_LI_ref",k);t("_LI_region",q.toLowerCase())})}
window.addEventListener?window.addEventListener("DOMContentLoaded",y,!1):window.attachEvent("DOMContentLoaded",y);})();
